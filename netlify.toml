[build]
  base = "."
  # Use custom build script to avoid package manager auto-detection issues
  command = "chmod +x netlify-build.sh && ./netlify-build.sh"
  publish = "apps/web/.next"
  functions = "services/identity/netlify/functions"

[context.production.environment]
  NODE_VERSION = "20"
  # TEMPORARY: enable preview/CI test seeds in production until identity is fully
  # restored. Remove as soon as real snapshots exist in the identity DB.
  ENABLE_TEST_SEEDS = "1"
  # Emergency frontend fallback: serve seeded snapshot client-side until identity
  # backend is fully restored. Remove after identity / DB seeding is complete.
  NEXT_PUBLIC_USE_SEED_SNAPSHOT = "1"

[[redirects]]
  from = "/api/v1/trust/center/:userId"
  to = "/.netlify/functions/trust-center?userId=:userId"
  status = 200
  force = false