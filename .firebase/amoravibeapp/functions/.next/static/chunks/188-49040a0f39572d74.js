"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[188],{9366:function(e,t,a){a.d(t,{OnboardingModalProvider:function(){return ee},V:function(){return et}});var l=a(7573),r=a(7653),n=a(7754),o=a(8605),i=a(3303),s=a(5623),c=a(9815),d=a(2988),u=a(1581),p=a(2958),m=a(1535),x=a(1871),h=a(4678),g=a(1071),y=a(5325),b=a(6215),f=a(3972),v=a(6271),j=a(4195),w=a(8575);let N=(0,r.createContext)(void 0);function C(e){let{children:t}=e,[a,n]=(0,r.useState)(null),[o,i]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{try{let e=localStorage.getItem("lovedate_onboarding");if(e){let t=JSON.parse(e);n(t),i(!0)}}catch(e){console.error("Failed to load onboarding data:",e)}},[]),(0,l.jsx)(N.Provider,{value:{data:a,saveOnboarding:e=>{try{localStorage.setItem("lovedate_onboarding",JSON.stringify(e)),n(e),i(!0)}catch(e){console.error("Failed to save onboarding data:",e)}},clearOnboarding:()=>{try{localStorage.removeItem("lovedate_onboarding"),n(null),i(!1)}catch(e){console.error("Failed to clear onboarding data:",e)}},isOnboarded:o},children:t})}var k=a(1482);a(8571);var P=a(8571);let S=e=>!e||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:"https://".concat(e),M=(0,k.MI)({baseUrl:(()=>{let e="https://api-amoravibe.vercel.app";if(!e)return"/api/trust";let t=S(e);try{let e=window.location.origin;if((t.startsWith("/")?e:new URL(t).origin)!==e)return"/api/trust"}catch(e){return"/api/trust"}return t})(),apiKey:P.env.TRUST_API_KEY});var E=a(8571);let O=["Travel","Fitness","Music","Movies","Cooking","Art","Reading","Gaming","Sports","Photography","Dancing","Yoga"],I=[{label:"Woman",value:"woman"},{label:"Man",value:"man"},{label:"Non-binary",value:"non_binary"},{label:"Trans woman",value:"trans_woman"},{label:"Trans man",value:"trans_man"},{label:"Self describe",value:"self_describe"}],L=[{label:"Heterosexual",value:"heterosexual"},{label:"Gay",value:"gay"},{label:"Lesbian",value:"lesbian"},{label:"Bisexual",value:"bisexual"},{label:"Pansexual",value:"pansexual"},{label:"Asexual",value:"asexual"},{label:"Queer",value:"queer"}],R=[{label:"Straight space",value:"straight",helper:"Strictly heterosexual trust lane."},{label:"LGBTQ+ space",value:"lgbtq",helper:"Queer-forward spotlighting."},{label:"Dual space",value:"both",helper:"Blend both lanes (bi / pan / queer)."}],A=[{label:"Women",value:"women",helper:"Appear to women-curated spaces."},{label:"Men",value:"men",helper:"Appear to men-curated spaces."},{label:"Everyone",value:"everyone",helper:"Unified pool, overrides others."}],T=[{value:"Long-term relationship",emoji:"\uD83D\uDC91"},{value:"Short-term relationship",emoji:"\uD83D\uDC9D"},{value:"Friendship",emoji:"\uD83E\uDD1D"},{value:"Casual dating",emoji:"☕"},{value:"Not sure yet",emoji:"\uD83E\uDD14"}],_=e=>{var t,a,l,r,n,o,i,s,c,d,u,p,m;let[x,h]=null!==(n=null!==(r=e.center)&&void 0!==r?r:null===(t=e.geometry)||void 0===t?void 0:t.coordinates)&&void 0!==n?n:[0,0],g=null!==(o=e.context)&&void 0!==o?o:[],y=g.find(e=>e.id.startsWith("country")),b=g.find(e=>e.id.startsWith("region")),f=null!==(i=e.text)&&void 0!==i?i:e.place_name;return{id:e.id,label:f,secondaryLabel:e.place_name,fullLabel:e.place_name,lat:h,lng:x,country:null!==(s=null==y?void 0:y.text)&&void 0!==s?s:null,countryCode:null!==(d=null!==(c=null==y?void 0:y.short_code)&&void 0!==c?c:null===(a=e.properties)||void 0===a?void 0:a.short_code)&&void 0!==d?d:null,region:null!==(u=null==b?void 0:b.text)&&void 0!==u?u:null,regionCode:null!==(p=null==b?void 0:b.short_code)&&void 0!==p?p:null,timezone:null!==(m=null===(l=e.properties)||void 0===l?void 0:l.timezone)&&void 0!==m?m:null}},U={firstName:"",lastName:"",displayName:"",dateOfBirth:"",email:"",phone:"",password:"",gender:"",orientation:"",orientationPreferences:[],discoverySpace:"",matchPreferences:[],lookingFor:"",interests:[],city:"",cityPlaceId:null,cityCountry:null,cityCountryCode:null,cityRegion:null,cityRegionCode:null,cityTimezone:null,cityLat:null,cityLng:null,locationAccuracyMeters:null,locationUpdatedAt:null,bio:"",photos:["",""],verificationIntent:"verify_now"},D=e=>{let t=e.indexOf(",");return Math.ceil(3*(t>=0?e.slice(t+1):e).length/4)},Z=async e=>{let t=await new Promise((t,a)=>{let l=new FileReader;l.onload=()=>t(l.result),l.onerror=()=>{var e;return a(null!==(e=l.error)&&void 0!==e?e:Error("Unable to read photo file."))},l.readAsDataURL(e)});if(e.size<=460800)return t;try{let e=await new Promise((e,a)=>{let l=new Image;l.onload=()=>e(l),l.onerror=()=>a(Error("Failed to load image for compression.")),l.src=t}),a=Math.max(e.width,e.height),l=a>1280?1280/a:1,r=document.createElement("canvas");r.width=Math.max(1,Math.round(e.width*l)),r.height=Math.max(1,Math.round(e.height*l));let n=r.getContext("2d");if(!n)return t;n.drawImage(e,0,0,r.width,r.height);let o=r.toDataURL("image/jpeg",.72);return D(o),o}catch(e){return console.warn("Photo compression failed, falling back to original photo payload.",e),t}},B=async e=>{try{let t=await new Promise((t,a)=>{let l=new Image;l.onload=()=>t(l),l.onerror=()=>a(Error("Failed to load image data for compression.")),l.src=e}),a=Math.max(t.width,t.height),l=a>1280?1280/a:1,r=(e,a)=>{let l=document.createElement("canvas");l.width=Math.max(1,Math.round(t.width*e)),l.height=Math.max(1,Math.round(t.height*e));let r=l.getContext("2d");return r?(r.drawImage(t,0,0,l.width,l.height),l.toDataURL("image/jpeg",a)):null},n=[.72,.6,.5,.4,.3],o=[l,.9*l,.8*l,.7*l];for(let e of o)for(let t of n){let a=r(e,t);if(a&&460800>=D(a))return a}let i=r(o[o.length-1],n[n.length-1]);return null!=i?i:e}catch(t){return console.warn("compressDataUrl failed",t),e}};function z(e){let{isOpen:t,onClose:a}=e,[m,x]=(0,r.useState)(0),[h,g]=(0,r.useState)(U),[y,b]=(0,r.useState)(!1),[f,v]=(0,r.useState)(null),[j,w]=(0,r.useState)(null),C=(0,n.useRouter)();(0,r.useEffect)(()=>{t||(x(0),g(U),v(null),w(null))},[t]);let k=(e,t)=>{g(a=>({...a,[e]:t}))},P=(0,r.useCallback)(e=>{g(t=>({...t,...e}))},[]),S=e=>{g(t=>({...t,interests:t.interests.includes(e)?t.interests.filter(t=>t!==e):[...t.interests,e]}))},E=e=>{g(t=>{let a=t.orientationPreferences.includes(e);return{...t,orientationPreferences:a?t.orientationPreferences.filter(t=>t!==e):[...t.orientationPreferences,e]}})},O=e=>{g(t=>{let a=t.matchPreferences.includes(e);if("everyone"===e)return{...t,matchPreferences:a?[]:["everyone"]};let l=t.matchPreferences.filter(e=>"everyone"!==e);return{...t,matchPreferences:a?l.filter(t=>t!==e):[...l,e]}})},I=(e,t)=>{g(a=>{let l=[...a.photos];return l[e]=t,{...a,photos:l}})},L=async(e,t)=>{if(t)try{let a=await Z(t);if(D(a)>460800)throw Error("Photo still exceeds inline size budget after compression.");I(e,a)}catch(e){console.error("Unable to process uploaded photo",e),v("Please choose a smaller photo (under 450 KB) or reduce its resolution.")}},R=()=>{g(e=>({...e,photos:[...e.photos,""]}))},A=e=>{g(t=>({...t,photos:t.photos.filter((t,a)=>a!==e)}))},T=(0,r.useMemo)(()=>{switch(m){case 0:return!!(h.firstName&&h.lastName&&h.displayName&&h.dateOfBirth&&h.gender&&h.orientation);case 1:return!!((h.email||h.phone)&&h.password.length>=8);case 2:return h.orientationPreferences.length>0&&h.matchPreferences.length>0&&""!==h.discoverySpace;case 3:return!!(h.lookingFor&&h.interests.length>=3);case 4:return h.city.trim().length>0&&h.bio.trim().length>=20&&h.photos.some(e=>e.trim().length>0);case 5:return!!h.verificationIntent;default:return!0}},[m,h]),_=function(){let e=(0,r.useContext)(N);if(!e)throw Error("useOnboarding must be used within OnboardingProvider");return e}(),z=async e=>{if(null==e||e.preventDefault(),T&&!y){b(!0),v(null);try{var t,l,r,n,o,i,s,c,d,u;for(let e=0;e<h.photos.length;e++){let t=h.photos[e];if(t&&t.startsWith("data:")&&D(t)>460800)try{let a=await B(t);a&&460800>=D(a)&&I(e,a)}catch(t){console.warn("Auto-compress failed for photo index",e,t)}}if(h.photos.map((e,t)=>e&&D(e)>460800?t:-1).filter(e=>e>=0).length>0){v("One or more photos exceed the 450 KB inline size limit. Please remove or choose smaller images."),b(!1);return}let e={legalName:h.firstName,legalLastName:h.lastName||void 0,displayName:h.displayName||h.firstName,dateOfBirth:h.dateOfBirth,email:h.email||void 0,phone:h.phone||void 0,password:h.password,gender:h.gender,orientation:h.orientation,orientationPreferences:h.orientationPreferences,discoverySpace:h.discoverySpace,matchPreferences:h.matchPreferences,city:h.city,cityPlaceId:null!==(t=h.cityPlaceId)&&void 0!==t?t:void 0,cityCountry:null!==(l=h.cityCountry)&&void 0!==l?l:void 0,cityCountryCode:null!==(r=h.cityCountryCode)&&void 0!==r?r:void 0,cityRegion:null!==(n=h.cityRegion)&&void 0!==n?n:void 0,cityRegionCode:null!==(o=h.cityRegionCode)&&void 0!==o?o:void 0,cityTimezone:null!==(i=h.cityTimezone)&&void 0!==i?i:void 0,cityLat:null!==(s=h.cityLat)&&void 0!==s?s:void 0,cityLng:null!==(c=h.cityLng)&&void 0!==c?c:void 0,locationAccuracyMeters:null!==(d=h.locationAccuracyMeters)&&void 0!==d?d:void 0,locationUpdatedAt:null!==(u=h.locationUpdatedAt)&&void 0!==u?u:void 0,bio:h.bio||void 0,photos:h.photos.filter(e=>e.trim().length>0),verificationIntent:h.verificationIntent},p=await M.submitOnboarding(e),m=p.user.id,x=p.user.displayName;_.saveOnboarding({userId:m,displayName:x,email:h.email,gender:h.gender,orientation:h.orientation,city:h.city,bio:h.bio,photos:h.photos.filter(e=>e.trim().length>0),completedAt:Date.now()});try{if(h.email||h.phone){let e={email:h.email||void 0,phone:h.phone||void 0,password:h.password},t=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok||console.warn("Auto-login after onboarding failed",await t.text().catch(()=>""))}}catch(e){console.warn("Auto-login error",e)}w("Welcome aboard, ".concat(x,"! Redirecting…")),setTimeout(()=>{var e;w(null),a(),C.push(null!==(e=p.nextRoute)&&void 0!==e?e:"/dashboard?userId=".concat(encodeURIComponent(m)))},1200)}catch(e){console.error("Onboarding submit error",e),v(e instanceof Error?e.message:"Something went wrong. Please try again.")}finally{b(!1)}}};return(0,l.jsx)(o.M,{children:t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm"}),(0,l.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,l.jsx)("div",{className:"flex min-h-screen items-center justify-center px-4 py-8",children:(0,l.jsxs)(i.E.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",duration:.45},className:"relative w-full max-w-2xl",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("button",{onClick:a,className:"absolute -top-5 -right-5 z-10 flex h-12 w-12 items-center justify-center rounded-full bg-white shadow-xl transition hover:bg-gray-100","aria-label":"Close onboarding modal",children:(0,l.jsx)(s.Z,{className:"h-6 w-6 text-gray-600"})}),(0,l.jsxs)(i.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8 text-center text-white",children:[(0,l.jsxs)("div",{className:"mb-4 flex items-center justify-center gap-2",children:[(0,l.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-purple-600 to-pink-600",children:(0,l.jsx)(c.Z,{className:"h-7 w-7 text-white"})}),(0,l.jsx)("span",{className:"bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-3xl font-bold text-transparent",children:"AmoraVibe"})]}),(0,l.jsx)("h2",{className:"text-3xl font-bold md:text-4xl",children:"Let’s complete your Trust Center profile"}),(0,l.jsx)("p",{className:"text-lg text-white/80",children:"Six guided steps • Safeguarded in real-time"})]}),(0,l.jsx)(F,{currentStep:m}),(0,l.jsxs)(i.E.form,{onSubmit:z,initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-3xl bg-white p-6 shadow-2xl md:p-10",children:[(0,l.jsx)(o.M,{mode:"wait",children:(()=>{switch(m){case 0:return(0,l.jsx)(W,{data:h,onChange:k},"step-identity");case 1:return(0,l.jsx)(V,{data:h,onChange:k},"step-contact");case 2:return(0,l.jsx)(K,{data:h,onChange:k,onToggleMatchPreference:O,onToggleOrientationPreference:E},"step-discovery");case 3:return(0,l.jsx)(G,{data:h,onChange:k,onToggleInterest:S},"step-intent");case 4:return(0,l.jsx)(q,{data:h,onChange:k,onBulkChange:P,onPhotoChange:I,onPhotoFileUpload:L,onAddPhoto:R,onRemovePhoto:A},"step-story");case 5:return(0,l.jsx)(J,{data:h,onChange:k},"step-verification");default:return null}})()}),f&&(0,l.jsx)("p",{className:"mt-6 rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700","aria-live":"polite",children:f}),j&&(0,l.jsx)("p",{className:"mt-6 rounded-2xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700","aria-live":"polite",children:j}),(0,l.jsxs)("div",{className:"mt-8 flex flex-wrap items-center gap-3",children:[m>0&&(0,l.jsxs)("button",{type:"button",onClick:()=>{x(e=>Math.max(e-1,0))},className:"flex items-center gap-2 rounded-xl border-2 border-gray-300 px-6 py-3 text-sm font-medium text-gray-700 transition hover:border-purple-600 hover:bg-purple-50",children:[(0,l.jsx)(d.Z,{className:"h-5 w-5"}),"Back"]}),m<5?(0,l.jsxs)("button",{type:"button",onClick:()=>{T&&x(e=>Math.min(e+1,5))},disabled:!T||y,className:"ml-auto flex items-center gap-2 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 px-8 py-3 text-sm font-semibold text-white transition hover:shadow-lg disabled:cursor-not-allowed disabled:opacity-50",children:["Next",(0,l.jsx)(u.Z,{className:"h-5 w-5"})]}):(0,l.jsxs)("button",{type:"submit",disabled:!T||y,className:"ml-auto flex items-center gap-2 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 px-8 py-3 text-sm font-semibold text-white transition hover:shadow-lg disabled:cursor-not-allowed disabled:opacity-50",children:[y?"Submitting…":"Create account",(0,l.jsx)(p.Z,{className:"h-5 w-5"})]})]})]})]})})})]})})}let F=e=>{let{currentStep:t}=e;return(0,l.jsx)("div",{className:"mb-6",children:(0,l.jsx)("div",{className:"mb-2 flex items-center justify-between",children:Array.from({length:6}).map((e,a)=>(0,l.jsxs)("div",{className:"flex flex-1 items-center",children:[(0,l.jsx)(i.E.div,{initial:!1,animate:{backgroundColor:a<=t?"rgb(147 51 234)":"rgb(229 231 235)",scale:a===t?1.15:1},className:"z-10 flex h-10 w-10 items-center justify-center rounded-full text-white font-bold",children:a<t?(0,l.jsx)(p.Z,{className:"h-5 w-5"}):a+1}),a<5&&(0,l.jsx)(i.E.div,{initial:!1,animate:{backgroundColor:a<t?"rgb(147 51 234)":"rgb(229 231 235)"},className:"mx-2 h-1 flex-1 rounded-full"})]},a))})})},W=e=>{let{data:t,onChange:a}=e;return(0,l.jsxs)(i.E.div,{initial:{opacity:0,x:40},animate:{opacity:1,x:0},exit:{opacity:0,x:-40},transition:{duration:.25},children:[(0,l.jsx)(X,{icon:(0,l.jsx)(m.Z,{className:"h-6 w-6"}),title:"Identity basics",helper:"Legal data stays encrypted but powers high-signal matching."}),(0,l.jsxs)("div",{className:"space-y-5",children:[(0,l.jsx)(Y,{label:"Legal first name",children:(0,l.jsx)("input",{type:"text",value:t.firstName,onChange:e=>a("firstName",e.target.value),className:"w-full rounded-xl border-2 border-gray-200 px-4 py-3 focus:border-purple-500 focus:outline-none",placeholder:"Ifeoluwa"})}),(0,l.jsx)(Y,{label:"Legal last name",children:(0,l.jsx)("input",{type:"text",value:t.lastName,onChange:e=>a("lastName",e.target.value),className:"w-full rounded-xl border-2 border-gray-200 px-4 py-3 focus:border-purple-500 focus:outline-none",placeholder:"Adeyemi"})}),(0,l.jsx)(Y,{label:"Display name",children:(0,l.jsx)("input",{type:"text",value:t.displayName,onChange:e=>a("displayName",e.target.value),className:"w-full rounded-xl border-2 border-gray-200 px-4 py-3 focus:border-purple-500 focus:outline-none",placeholder:"What should matches call you?"})}),(0,l.jsx)(Y,{label:"Date of birth",children:(0,l.jsx)("input",{type:"date",value:t.dateOfBirth,onChange:e=>a("dateOfBirth",e.target.value),className:"w-full rounded-xl border-2 border-gray-200 px-4 py-3 focus:border-purple-500 focus:outline-none"})}),(0,l.jsx)(Y,{label:"Gender",children:(0,l.jsx)("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3",children:I.map(e=>(0,l.jsx)(Q,{label:e.label,selected:t.gender===e.value,onClick:()=>a("gender",e.value)},e.value))})}),(0,l.jsx)(Y,{label:"Orientation",children:(0,l.jsx)("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3",children:L.map(e=>(0,l.jsx)(Q,{label:e.label,selected:t.orientation===e.value,onClick:()=>a("orientation",e.value)},e.value))})})]})]},"identity")},V=e=>{let{data:t,onChange:a}=e;return(0,l.jsxs)(i.E.div,{initial:{opacity:0,x:40},animate:{opacity:1,x:0},exit:{opacity:0,x:-40},transition:{duration:.25},children:[(0,l.jsx)(X,{icon:(0,l.jsx)(x.Z,{className:"h-6 w-6"}),title:"Contact & security",helper:"Use at least one channel so we can keep your account safe."}),(0,l.jsxs)("div",{className:"space-y-5",children:[(0,l.jsx)(Y,{label:"Email address",icon:(0,l.jsx)(h.Z,{className:"h-4 w-4 text-gray-400"}),children:(0,l.jsx)("input",{type:"email",value:t.email,onChange:e=>a("email",e.target.value),className:"w-full rounded-xl border-2 border-gray-200 px-4 py-3 pl-10 focus:border-purple-500 focus:outline-none",placeholder:"you@email.com"})}),(0,l.jsx)(Y,{label:"Phone number",icon:(0,l.jsx)(H,{}),children:(0,l.jsx)("input",{type:"tel",value:t.phone,onChange:e=>a("phone",e.target.value),className:"w-full rounded-xl border-2 border-gray-200 px-4 py-3 pl-10 focus:border-purple-500 focus:outline-none",placeholder:"+1 555 123 4567"})}),(0,l.jsx)(Y,{label:"Password",icon:(0,l.jsx)(g.Z,{className:"h-4 w-4 text-gray-400"}),children:(0,l.jsx)("input",{type:"password",value:t.password,onChange:e=>a("password",e.target.value),className:"w-full rounded-xl border-2 border-gray-200 px-4 py-3 pl-10 focus:border-purple-500 focus:outline-none",placeholder:"Min 8 characters"})})]})]},"contact")},K=e=>{let{data:t,onChange:a,onToggleMatchPreference:r,onToggleOrientationPreference:n}=e;return(0,l.jsxs)(i.E.div,{initial:{opacity:0,x:40},animate:{opacity:1,x:0},exit:{opacity:0,x:-40},transition:{duration:.25},children:[(0,l.jsx)(X,{icon:(0,l.jsx)(y.Z,{className:"h-6 w-6"}),title:"Discovery preferences",helper:"We tune visibility lanes so the right people find you fast."}),(0,l.jsxs)("div",{className:"space-y-5",children:[(0,l.jsx)(Y,{label:"Orientation preferences",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-3",children:L.map(e=>(0,l.jsx)(Q,{label:e.label,selected:t.orientationPreferences.includes(e.value),onClick:()=>n(e.value),multi:!0},e.value))})}),(0,l.jsx)(Y,{label:"Visibility lanes",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-3",children:A.map(e=>(0,l.jsx)(Q,{label:e.label,helper:e.helper,selected:t.matchPreferences.includes(e.value),onClick:()=>r(e.value),multi:!0},e.value))})}),(0,l.jsx)(Y,{label:"Discovery space",children:(0,l.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:R.map(e=>(0,l.jsxs)("button",{type:"button",onClick:()=>a("discoverySpace",e.value),className:"rounded-2xl border-2 px-4 py-4 text-left transition hover:border-purple-500 ".concat(t.discoverySpace===e.value?"border-purple-600 bg-purple-50":"border-gray-200"),children:[(0,l.jsx)("p",{className:"text-base font-semibold text-gray-900",children:e.label}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:e.helper})]},e.value))})})]})]},"discovery")},G=e=>{let{data:t,onChange:a,onToggleInterest:r}=e;return(0,l.jsxs)(i.E.div,{initial:{opacity:0,x:40},animate:{opacity:1,x:0},exit:{opacity:0,x:-40},transition:{duration:.25},children:[(0,l.jsx)(X,{icon:(0,l.jsx)(b.Z,{className:"h-6 w-6"}),title:"What are you looking for?",helper:"Signals make it easier to pair you with compatible intentions."}),(0,l.jsxs)("div",{className:"space-y-5",children:[(0,l.jsx)(Y,{label:"Relationship intent",children:(0,l.jsx)("div",{className:"grid gap-3 sm:grid-cols-2",children:T.map(e=>(0,l.jsxs)("button",{type:"button",onClick:()=>a("lookingFor",e.value),className:"flex items-center gap-3 rounded-2xl border-2 px-4 py-4 text-left transition ".concat(t.lookingFor===e.value?"border-purple-600 bg-purple-50":"border-gray-200"),children:[(0,l.jsx)("span",{className:"text-2xl",children:e.emoji}),(0,l.jsx)("span",{className:"text-base font-semibold text-gray-900",children:e.value})]},e.value))})}),(0,l.jsx)(Y,{label:"Your interests (choose at least 3)",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:O.map(e=>(0,l.jsx)(Q,{label:e,selected:t.interests.includes(e),onClick:()=>r(e),multi:!0},e))})})]})]},"intent")},q=e=>{let{data:t,onChange:a,onBulkChange:n,onPhotoChange:o,onPhotoFileUpload:s,onAddPhoto:c,onRemovePhoto:d}=e,u=E.env.NEXT_PUBLIC_MAPBOX_TOKEN,[p,m]=(0,r.useState)([]),[x,h]=(0,r.useState)(!1),[g,y]=(0,r.useState)(!1),[b,w]=(0,r.useState)(null),[N,C]=(0,r.useState)(!1),k=(0,r.useRef)(!1),P=(0,r.useCallback)(()=>n({cityPlaceId:null,cityCountry:null,cityCountryCode:null,cityRegion:null,cityRegionCode:null,cityTimezone:null,cityLat:null,cityLng:null,locationAccuracyMeters:null,locationUpdatedAt:null}),[n]),S=e=>{w(null),n({city:e}),P(),h(!!e.trim().length)},M=(0,r.useCallback)((e,t)=>{var a,l,r,o,i;k.current=!0,n({city:e.fullLabel,cityPlaceId:e.id,cityCountry:null!==(a=e.country)&&void 0!==a?a:null,cityCountryCode:null!==(l=e.countryCode)&&void 0!==l?l:null,cityRegion:null!==(r=e.region)&&void 0!==r?r:null,cityRegionCode:null!==(o=e.regionCode)&&void 0!==o?o:null,cityTimezone:null!==(i=e.timezone)&&void 0!==i?i:null,cityLat:e.lat,cityLng:e.lng,locationAccuracyMeters:null!=t?t:null,locationUpdatedAt:new Date().toISOString()}),m([]),h(!1)},[n]);return(0,r.useEffect)(()=>{if(!u){m([]);return}if(k.current){k.current=!1;return}let e=t.city.trim();if(e.length<2){m([]);return}let a=new AbortController;y(!0);let l=setTimeout(async()=>{try{var t;let l=new URL("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(encodeURIComponent(e),".json"));l.searchParams.set("access_token",u),l.searchParams.set("types","place,locality"),l.searchParams.set("limit","5"),l.searchParams.set("autocomplete","true");let r=await fetch(l.toString(),{signal:a.signal});if(!r.ok)throw Error("Mapbox geocoding failed");let n=await r.json();m((null!==(t=n.features)&&void 0!==t?t:[]).map(_)),w(null),h(!0)}catch(e){a.signal.aborted||(console.error("Mapbox geocoding error",e),w("Unable to fetch city suggestions. Please try again."),m([]))}finally{a.signal.aborted||y(!1)}},350);return()=>{clearTimeout(l),a.abort()}},[t.city,u]),(0,l.jsxs)(i.E.div,{initial:{opacity:0,x:40},animate:{opacity:1,x:0},exit:{opacity:0,x:-40},transition:{duration:.25},children:[(0,l.jsx)(X,{icon:(0,l.jsx)(f.Z,{className:"h-6 w-6"}),title:"Profile story",helper:"Ground your profile with context, voice, and proof-of-life shots."}),(0,l.jsxs)("div",{className:"space-y-5",children:[(0,l.jsxs)(Y,{label:"City",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row",children:[(0,l.jsx)("input",{type:"text",value:t.city,onChange:e=>S(e.target.value),className:"flex-1 rounded-xl border-2 border-gray-200 px-4 py-3 focus:border-purple-500 focus:outline-none",placeholder:"Brooklyn, New York",autoComplete:"off"}),(0,l.jsxs)("button",{type:"button",onClick:()=>{if(!navigator.geolocation){w("Location services are not supported on this device.");return}if(!u){w("Mapbox token missing. Add NEXT_PUBLIC_MAPBOX_TOKEN and reload.");return}C(!0),navigator.geolocation.getCurrentPosition(async e=>{try{var t;let{latitude:a,longitude:l,accuracy:r}=e.coords,n=new URL("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(l,",").concat(a,".json"));n.searchParams.set("access_token",u),n.searchParams.set("types","place,locality"),n.searchParams.set("limit","1");let o=await fetch(n.toString());if(!o.ok)throw Error("Reverse geocoding failed");let i=await o.json(),s=null===(t=i.features)||void 0===t?void 0:t[0];s?M(_(s),null!=r?r:null):w("We could not determine a city for your location.")}catch(e){console.error("Geolocation reverse lookup failed",e),w("Unable to resolve your location at the moment.")}finally{C(!1)}},e=>{C(!1),w(e.message||"Unable to access your location.")},{enableHighAccuracy:!0,timeout:1e4})},disabled:N,className:"inline-flex items-center justify-center gap-2 rounded-xl border-2 border-gray-200 px-4 py-3 text-sm font-semibold text-gray-600 transition hover:border-purple-500 hover:text-purple-600 disabled:cursor-not-allowed disabled:opacity-60",children:[(0,l.jsx)(v.Z,{className:"h-4 w-4"}),N?"Locating…":"Use my location"]})]}),b&&(0,l.jsx)("p",{className:"text-sm text-rose-600",children:b}),!u&&(0,l.jsx)("p",{className:"text-sm text-amber-600",children:"Map search is offline until a Mapbox token is configured."})]}),x&&p.length>0&&(0,l.jsx)("ul",{className:"mt-2 max-h-56 overflow-y-auto rounded-2xl border border-gray-200 bg-white shadow-xl",children:p.map(e=>(0,l.jsx)("li",{children:(0,l.jsxs)("button",{type:"button",className:"flex w-full flex-col items-start gap-1 px-4 py-3 text-left hover:bg-purple-50",onClick:()=>M(e),children:[(0,l.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:e.label}),(0,l.jsx)("span",{className:"text-xs text-gray-500",children:e.secondaryLabel})]})},e.id))}),g&&(0,l.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"Searching Mapbox…"})]}),(0,l.jsx)(Y,{label:"Bio (min 20 characters)",children:(0,l.jsx)("textarea",{value:t.bio,onChange:e=>a("bio",e.target.value),className:"h-32 w-full rounded-xl border-2 border-gray-200 px-4 py-3 focus:border-purple-500 focus:outline-none",placeholder:"Share your story, quirks, or what lights you up."})}),(0,l.jsx)(Y,{label:"Photos",children:(0,l.jsxs)("div",{className:"space-y-4",children:[t.photos.map((e,a)=>(0,l.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[(0,l.jsxs)("div",{className:"flex flex-1 items-center rounded-2xl border-2 border-dashed border-gray-200 px-4 py-3",children:[(0,l.jsx)(j.Z,{className:"mr-3 h-5 w-5 text-gray-400"}),(0,l.jsx)("input",{type:"url",value:e,onChange:e=>o(a,e.target.value),className:"w-full bg-transparent focus:outline-none",placeholder:"https://images.lovedate.com/you.jpg"})]}),(0,l.jsxs)("label",{className:"flex w-full max-w-[160px] cursor-pointer items-center justify-center rounded-xl border border-gray-200 px-3 py-2 text-sm font-semibold text-gray-600 transition hover:border-purple-500 hover:text-purple-600",children:["Upload",(0,l.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t,l;return s(a,null!==(l=null===(t=e.target.files)||void 0===t?void 0:t[0])&&void 0!==l?l:null)}})]}),t.photos.length>1&&(0,l.jsx)("button",{type:"button",onClick:()=>d(a),className:"rounded-xl border border-gray-200 px-3 py-2 text-sm text-gray-500 hover:border-rose-400 hover:text-rose-500",children:"Remove"}),e&&D(e)>460800&&(0,l.jsx)("p",{className:"mt-1 text-xs text-rose-600",children:"This image exceeds the 450 KB inline upload limit."})]},a)),t.photos.length<5&&(0,l.jsx)("button",{type:"button",onClick:c,className:"flex items-center gap-2 text-sm font-semibold text-purple-600",children:"+ Add another link"})]})})]})]},"story")},J=e=>{let{data:t,onChange:a}=e;return(0,l.jsxs)(i.E.div,{initial:{opacity:0,x:40},animate:{opacity:1,x:0},exit:{opacity:0,x:-40},transition:{duration:.25},children:[(0,l.jsx)(X,{icon:(0,l.jsx)(w.Z,{className:"h-6 w-6"}),title:"Verification",helper:"Opt into live verification now or schedule it for later."}),(0,l.jsx)(Y,{label:"Verification intent",children:(0,l.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:[{value:"verify_now",label:"Verify now",helper:"Fast-lane into premium visibility."},{value:"verify_later",label:"Verify later",helper:"We’ll remind you after onboarding."}].map(e=>(0,l.jsxs)("button",{type:"button",onClick:()=>a("verificationIntent",e.value),className:"rounded-2xl border-2 px-4 py-4 text-left transition ".concat(t.verificationIntent===e.value?"border-purple-600 bg-purple-50":"border-gray-200"),children:[(0,l.jsx)("p",{className:"text-base font-semibold text-gray-900",children:e.label}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:e.helper})]},e.value))})}),(0,l.jsx)("div",{className:"mt-6 rounded-2xl bg-gray-50 px-4 py-4 text-sm text-gray-600",children:(0,l.jsxs)("p",{className:"flex items-center gap-2",children:[(0,l.jsx)(w.Z,{className:"h-4 w-4 text-purple-600"}),"Verification unlocks deeper trust signals, feature access, and faster approvals."]})})]},"verification")};function X(e){let{icon:t,title:a,helper:r}=e;return(0,l.jsxs)("div",{className:"mb-6 flex items-start gap-4",children:[(0,l.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-purple-50 text-purple-600",children:t}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:a}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:r})]})]})}function Y(e){let{label:t,icon:a,children:r}=e;return(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-900",children:[(0,l.jsx)("span",{className:"mb-2 block text-sm text-gray-600",children:t}),(0,l.jsxs)("div",{className:"relative",children:[a&&(0,l.jsx)("span",{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2",children:a}),r]})]})}function Q(e){let{label:t,selected:a,onClick:r,multi:n,helper:o}=e;return(0,l.jsxs)("button",{type:"button",onClick:r,className:"rounded-2xl border-2 px-4 py-3 text-left text-sm font-semibold transition ".concat(a?"border-purple-600 bg-purple-50 text-purple-700":"border-gray-200 text-gray-700"," ").concat(n?"min-w-[140px]":"w-full"),children:[t,o&&(0,l.jsx)("p",{className:"mt-1 text-xs font-normal text-gray-500",children:o})]})}let H=()=>(0,l.jsxs)("svg",{className:"h-4 w-4 text-gray-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,l.jsx)("path",{d:"M2 3h20"}),(0,l.jsx)("path",{d:"M2 8h20"}),(0,l.jsx)("path",{d:"M5 3v5"}),(0,l.jsx)("path",{d:"M19 3v5"}),(0,l.jsx)("rect",{x:"4",y:"11",width:"16",height:"10",rx:"2"})]}),$=(0,r.createContext)(null);function ee(e){let{children:t}=e,[a,n]=(0,r.useState)(!1),o=(0,r.useCallback)(()=>n(!0),[]),i=(0,r.useCallback)(()=>n(!1),[]);return(0,l.jsx)(C,{children:(0,l.jsxs)($.Provider,{value:{openModal:o,closeModal:i},children:[t,(0,l.jsx)(z,{isOpen:a,onClose:i})]})})}function et(){let e=(0,r.useContext)($);if(!e)throw Error("useOnboardingModal must be used within an OnboardingModalProvider");return e}},3423:function(e,t,a){a.d(t,{SignInModalProvider:function(){return y},S:function(){return b}});var l=a(7573),r=a(7653),n=a(7754),o=a(8605),i=a(3303),s=a(4678),c=a(8573),d=a(5623),u=a(1071),p=a(7749),m=a(649);let x={email:"",phone:"",password:"",mode:"email"};function h(e){let{isOpen:t,onClose:a}=e,[h,g]=(0,r.useState)(x),[y,b]=(0,r.useState)(!1),[f,v]=(0,r.useState)(null),[j,w]=(0,r.useState)(null),N=(0,n.useRouter)();(0,r.useEffect)(()=>{t||(g(x),b(!1),v(null),w(null))},[t]);let C="email"===h.mode?s.Z:c.Z,k=(0,r.useMemo)(()=>"email"===h.mode?"Email address":"Phone number",[h.mode]),P="email"===h.mode?h.email:h.phone,S=P.trim().length>3&&h.password.length>=8&&!y,M=(e,t)=>{g(a=>({...a,[e]:t}))},E=e=>{g(t=>({...t,mode:e}))},O=async e=>{if(e.preventDefault(),S){b(!0),v(null);try{let e={email:"email"===h.mode?h.email.trim():void 0,phone:"phone"===h.mode?h.phone.trim():void 0,password:h.password},r=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){var t,l;throw Error(null!==(l=null===(t=await r.json().catch(()=>null))||void 0===t?void 0:t.message)&&void 0!==l?l:"Invalid credentials.")}let n=await r.json();w("Welcome back, ".concat(n.user.displayName,"! Redirecting…")),setTimeout(()=>{var e;w(null),a(),N.push(null!==(e=n.nextRoute)&&void 0!==e?e:"/dashboard")},1100)}catch(e){v(e instanceof Error?e.message:"Unable to sign you in.")}finally{b(!1)}}};return(0,l.jsx)(o.M,{children:t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:.6},exit:{opacity:0},className:"fixed inset-0 z-50 bg-ink-900/80 backdrop-blur",onClick:a}),(0,l.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,l.jsx)("div",{className:"flex min-h-screen items-center justify-center px-4 py-10",children:(0,l.jsxs)(i.E.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",duration:.4},className:"relative w-full max-w-md",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("button",{type:"button",onClick:a,className:"absolute -top-4 -right-4 flex h-11 w-11 items-center justify-center rounded-full bg-white shadow-lg transition hover:bg-ink-50","aria-label":"Close sign-in modal",children:(0,l.jsx)(d.Z,{className:"h-5 w-5 text-ink-700"})}),(0,l.jsxs)("div",{className:"rounded-3xl bg-white p-8 shadow-2xl",children:[(0,l.jsxs)("div",{className:"mb-6 text-center",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-[0.4em] text-ink-500",children:"Lovedate"}),(0,l.jsx)("h2",{className:"mt-3 font-display text-3xl text-ink-900",children:"Sign in to continue"}),(0,l.jsx)("p",{className:"mt-2 text-sm text-ink-600",children:"Secure access to your trust dashboard."})]}),(0,l.jsxs)("form",{onSubmit:O,className:"space-y-5",children:[(0,l.jsx)("div",{className:"flex rounded-full bg-ink-50 p-1",children:["email","phone"].map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>E(e),className:"flex-1 rounded-full px-4 py-2 text-sm font-medium transition ".concat(h.mode===e?"bg-white text-ink-900 shadow-sm":"text-ink-500"),children:"email"===e?"Email":"Phone"},e))}),(0,l.jsxs)("label",{className:"block space-y-2",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-ink-700",children:k}),(0,l.jsxs)("div",{className:"flex items-center gap-3 rounded-2xl border border-ink-200 px-4 py-3 focus-within:border-ink-900",children:[(0,l.jsx)(C,{className:"h-4 w-4 text-ink-400"}),(0,l.jsx)("input",{type:"email"===h.mode?"email":"tel",autoComplete:"email"===h.mode?"email":"tel",value:P,onChange:e=>M(h.mode,e.currentTarget.value),className:"w-full bg-transparent text-ink-900 outline-none",placeholder:"email"===h.mode?"you@example.com":"+1 (415) 555-0101"})]})]}),(0,l.jsxs)("label",{className:"block space-y-2",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-ink-700",children:"Password"}),(0,l.jsxs)("div",{className:"flex items-center gap-3 rounded-2xl border border-ink-200 px-4 py-3 focus-within:border-ink-900",children:[(0,l.jsx)(u.Z,{className:"h-4 w-4 text-ink-400"}),(0,l.jsx)("input",{type:"password",autoComplete:"current-password",value:h.password,onChange:e=>M("password",e.currentTarget.value),className:"w-full bg-transparent text-ink-900 outline-none",placeholder:"At least 8 characters"})]})]}),f&&(0,l.jsx)("p",{className:"rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700","aria-live":"polite",children:f}),j&&(0,l.jsxs)("p",{className:"flex items-center gap-2 rounded-2xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700","aria-live":"polite",children:[(0,l.jsx)(p.Z,{className:"h-4 w-4"}),j]}),(0,l.jsx)("button",{type:"submit",disabled:!S,className:"flex w-full items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-purple-600 to-pink-600 py-3 text-white shadow-lg transition hover:shadow-xl disabled:cursor-not-allowed disabled:opacity-60",children:y?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m.Z,{className:"h-4 w-4 animate-spin"}),"Signing in…"]}):"Sign in"})]})]})]})})})]})})}let g=(0,r.createContext)(null);function y(e){let{children:t}=e,[a,n]=(0,r.useState)(!1),o=(0,r.useCallback)(()=>n(!0),[]),i=(0,r.useCallback)(()=>n(!1),[]);return(0,l.jsxs)(g.Provider,{value:{openModal:o,closeModal:i},children:[t,(0,l.jsx)(h,{isOpen:a,onClose:i})]})}function b(){let e=(0,r.useContext)(g);if(!e)throw Error("useSignInModal must be used within a SignInModalProvider");return e}}}]);